
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2.2. Calibrating bias images &#8212; CCD Data Reduction Guide</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e2363ea40746bee74734a24ffefccd78.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="2.3. Combine bias images to make master" href="02-04-Combine-bias-images-to-make-master.html" />
    <link rel="prev" title="2.1. About bias and overscan" href="02-01-overscan-trimming-and-bias-subtraction-background.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">CCD Data Reduction Guide</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="00-00-Preface.html">
   Preface
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="01-00-Understanding-an-astronomical-CCD-image.html">
   1. Astronomical Images
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="01-01-astronomical-CCD-image-components.html">
     1.1. Components of astronomical images
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="01-03-Construction-of-an-artificial-but-realistic-image.html">
     1.2. An artificial, but realistic, image
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="01-04-Nonuniform-sensitivity.html">
     1.3. Non-uniform sensitivity in astronomical detectors
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="01-05-Calibration-overview.html">
     1.4. Calibration overview
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="01-06-Image-combination.html">
     1.5. Image combination
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="01-08-Overscan.html">
     1.6. Overscan
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="01-09-Calibration-choices-you-need-to-make.html">
     1.7. Calibration choices to make
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="01-11-reading-images.html">
     1.8. Reading images
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="02-00-Handling-overscan-trimming-and-bias-subtraction.html">
   2. Overscan and bias images
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="02-01-overscan-trimming-and-bias-subtraction-background.html">
     2.1. About bias and overscan
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     2.2. Calibrating bias images
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02-04-Combine-bias-images-to-make-master.html">
     2.3. Combine bias images to make master bias
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="03-00-Dark-current-and-hot-pixels.html">
   3. Dark current and dark frames
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="03-01-Dark-current-The-ideal-case.html">
     3.1. Dark current: the ideal case
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03-02-Real-dark-current-noise-and-other-artifacts.html">
     3.2. Real dark current: noise and other artifacts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03-04-Handling-overscan-and-bias-for-dark-frames.html">
     3.3. Handling overscan and bias for dark frames
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03-05-Calibrate-dark-images.html">
     3.4. Calibrate dark images
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03-06-Combine-darks-for-use-in-later-calibration-steps.html">
     3.5. Combine calibrated dark images for use in later reduction steps
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="05-00-Flat-corrections.html">
   4. Flat fielding
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="05-01-about-flat-corrections.html">
     4.1. Calibrating flat frames
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="05-03-Calibrating-the-flats.html">
     4.2. Calibrating flat frames
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="05-04-Combining-flats.html">
     4.3. Combining flat frames
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="06-00-Reducing-science-images.html">
   5. Calibrating science images
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="06-03-science-images-calibration-examples.html">
     5.1. Two calibration examples
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="08-00-Image-masking.html">
   6. Finding and dealing with bad pixels
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="08-01-Identifying-hot-pixels.html">
     6.1. Identifying hot pixels
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-02-Creating-a-mask.html">
     6.2. Identifying bad pixels with ccdmask
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-03-Cosmic-ray-removal.html">
     6.3. Removing cosmic rays
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-05-incorporating-masks-into-calibrated-science-images.html">
     6.4. Incorporating masks in science images
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  <h2>Book edition 2.0.0</h2></br>
Powered by <a href="https://jupyterbook.org">Jupyter Book</a> and
<a href="https://astropy.org">Astropy</a>

</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/notebooks/02-02-Calibrating-bias-images.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        
        <a class="issues-button"
            href="https://github.com/astropy/ccd-reduction-and-photometry-guide/issues/new?title=Issue%20on%20page%20%2Fnotebooks/02-02-Calibrating-bias-images.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/astropy/ccd-reduction-and-photometry-guide/edit/main/notebooks/notebooks/02-02-Calibrating-bias-images.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/astropy/ccd-reduction-and-photometry-guide/main?urlpath=lab/tree/notebooks/notebooks/02-02-Calibrating-bias-images.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-for-these-examples">
   2.2.1. Data for these examples
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-1-with-overscan-subtraction">
   2.2.2. Example 1: With overscan subtraction
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#decide-where-to-put-your-example-1-calibrated-images">
     2.2.2.1. Decide where to put your Example 1 calibrated images
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#make-an-image-file-collection-for-the-raw-data">
     2.2.2.2. Make an image file collection for the raw data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#determine-overscan-region-for-the-lfc-chip-0">
     2.2.2.3. Determine overscan region for the LFC Chip 0
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fits-vs-python-indexing">
     2.2.2.4. FITS vs. Python indexing
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#subtract-and-then-trim-the-overscan-one-sample-image">
     2.2.2.5. Subtract and then trim the overscan (one sample image)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#discussion">
     2.2.2.6. Discussion
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#processing-the-folder-of-bias-images-for-the-lfc-chip-0">
     2.2.2.7. Processing the folder of bias images for the LFC Chip 0
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-2-no-overscan-subtraction-but-trim-the-images">
   2.2.3. Example 2: No overscan subtraction, but trim the images
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#decide-where-to-put-your-calibrated-example-2-images">
     2.2.3.1. Decide where to put your calibrated Example 2 images
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#determine-overscan-region-for-this-camera">
     2.2.3.2. Determine overscan region for this camera
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#trim-the-overscan-one-sample-image">
     2.2.3.3. Trim the overscan (one sample image)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#processing-the-folder-of-bias-images-for-example-2">
     2.2.3.4. Processing the folder of bias images for Example 2
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-3-no-overscan-at-all">
   2.2.4. Example 3: No overscan at all
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="calibrating-bias-images">
<h1><span class="section-number">2.2. </span>Calibrating bias images<a class="headerlink" href="#calibrating-bias-images" title="Permalink to this headline">¶</a></h1>
<p>The purpose of calibrating bias images is threefold:</p>
<ul class="simple">
<li><p>Subtract overscan if you have decided your science will be better if you
subtract overscan. See <a class="reference internal" href="01-08-Overscan.html"><span class="doc std std-doc">this discussion of overscan</span></a> for some guidance.</p></li>
<li><p>Trim the overscan region off of the image if it is present, regardless of
whether or not you have chosen to subtract the overscan.</p></li>
<li><p>Combine the bias images into a “combined” bias to be used in calibrating the
rest of the images. The purpose of combining several images is to reduce as much
as possible the read noise in the combined bias.</p></li>
</ul>
<p>The approach in this notebook will be to reduce a single image, look at the
effects the reduction step had on that image and then demonstrate how to
calibrate a folder containing several images of that type.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="kn">import</span> <span class="n">CCDData</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">hist</span>
<span class="kn">import</span> <span class="nn">ccdproc</span> <span class="k">as</span> <span class="nn">ccdp</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">convenience_functions</span> <span class="kn">import</span> <span class="n">show_image</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: AstropyDeprecationWarning: block_reduce was moved to the astropy.nddata.blocks module.  Please update your import statement. [astropy.nddata.utils]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use custom style for larger fonts and figures</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;guide.mplstyle&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="data-for-these-examples">
<h2><span class="section-number">2.2.1. </span>Data for these examples<a class="headerlink" href="#data-for-these-examples" title="Permalink to this headline">¶</a></h2>
<p>See the <a class="reference internal" href="00-00-Preface.html"><span class="doc std std-doc">Preface notebook</span></a> for download links for all data.</p>
</div>
<div class="section" id="example-1-with-overscan-subtraction">
<h2><span class="section-number">2.2.2. </span>Example 1: With overscan subtraction<a class="headerlink" href="#example-1-with-overscan-subtraction" title="Permalink to this headline">¶</a></h2>
<div class="section" id="decide-where-to-put-your-example-1-calibrated-images">
<h3><span class="section-number">2.2.2.1. </span>Decide where to put your Example 1 calibrated images<a class="headerlink" href="#decide-where-to-put-your-example-1-calibrated-images" title="Permalink to this headline">¶</a></h3>
<p>Though it is possible to overwrite your raw data with calibrated images, this is not recommended. Here we create a folder called <code class="docutils literal notranslate"><span class="pre">example1-reduced</span></code> that will contain
the calibrated data and create it if it doesn’t exist.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">calibrated_data</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;example1-reduced&#39;</span><span class="p">)</span>
<span class="n">calibrated_data</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="make-an-image-file-collection-for-the-raw-data">
<h3><span class="section-number">2.2.2.2. </span>Make an image file collection for the raw data<a class="headerlink" href="#make-an-image-file-collection-for-the-raw-data" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">example_cryo_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;example-cryo-LFC&#39;</span><span class="p">)</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">ccdp</span><span class="o">.</span><span class="n">ImageFileCollection</span><span class="p">(</span><span class="n">example_cryo_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">files</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;imagetyp&#39;</span><span class="p">,</span> <span class="s1">&#39;filter&#39;</span><span class="p">,</span> <span class="s1">&#39;exptime&#39;</span><span class="p">,</span> <span class="s1">&#39;naxis1&#39;</span><span class="p">,</span> <span class="s1">&#39;naxis2&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>Table length=14</i>
<table id="table139897117843216" class="table-striped table-bordered table-condensed">
<thead><tr><th>file</th><th>imagetyp</th><th>filter</th><th>exptime</th><th>naxis1</th><th>naxis2</th></tr></thead>
<thead><tr><th>str14</th><th>str9</th><th>str2</th><th>float64</th><th>int64</th><th>int64</th></tr></thead>
<tr><td>ccd.001.0.fits</td><td>BIAS</td><td>i&apos;</td><td>0.0</td><td>2080</td><td>4128</td></tr>
<tr><td>ccd.002.0.fits</td><td>BIAS</td><td>i&apos;</td><td>0.0</td><td>2080</td><td>4128</td></tr>
<tr><td>ccd.003.0.fits</td><td>BIAS</td><td>i&apos;</td><td>0.0</td><td>2080</td><td>4128</td></tr>
<tr><td>ccd.004.0.fits</td><td>BIAS</td><td>i&apos;</td><td>0.0</td><td>2080</td><td>4128</td></tr>
<tr><td>ccd.005.0.fits</td><td>BIAS</td><td>i&apos;</td><td>0.0</td><td>2080</td><td>4128</td></tr>
<tr><td>ccd.006.0.fits</td><td>BIAS</td><td>i&apos;</td><td>0.0</td><td>2080</td><td>4128</td></tr>
<tr><td>ccd.014.0.fits</td><td>FLATFIELD</td><td>g&apos;</td><td>70.001</td><td>2080</td><td>4128</td></tr>
<tr><td>ccd.015.0.fits</td><td>FLATFIELD</td><td>g&apos;</td><td>70.011</td><td>2080</td><td>4128</td></tr>
<tr><td>ccd.016.0.fits</td><td>FLATFIELD</td><td>g&apos;</td><td>70.001</td><td>2080</td><td>4128</td></tr>
<tr><td>ccd.017.0.fits</td><td>FLATFIELD</td><td>i&apos;</td><td>7.0</td><td>2080</td><td>4128</td></tr>
<tr><td>ccd.018.0.fits</td><td>FLATFIELD</td><td>i&apos;</td><td>7.0</td><td>2080</td><td>4128</td></tr>
<tr><td>ccd.019.0.fits</td><td>FLATFIELD</td><td>i&apos;</td><td>7.0</td><td>2080</td><td>4128</td></tr>
<tr><td>ccd.037.0.fits</td><td>OBJECT</td><td>g&apos;</td><td>300.062</td><td>2080</td><td>4128</td></tr>
<tr><td>ccd.043.0.fits</td><td>OBJECT</td><td>i&apos;</td><td>300.014</td><td>2080</td><td>4128</td></tr>
</table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">darks_only</span> <span class="o">=</span> <span class="n">ccdp</span><span class="o">.</span><span class="n">ImageFileCollection</span><span class="p">(</span><span class="n">example_cryo_path</span> <span class="o">/</span> <span class="s1">&#39;darks&#39;</span><span class="p">)</span>
<span class="n">darks_only</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;imagetyp&#39;</span><span class="p">,</span> <span class="s1">&#39;exptime&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>Table length=10</i>
<table id="table139897117842112" class="table-striped table-bordered table-condensed">
<thead><tr><th>file</th><th>imagetyp</th><th>exptime</th></tr></thead>
<thead><tr><th>str14</th><th>str4</th><th>float64</th></tr></thead>
<tr><td>ccd.002.0.fits</td><td>BIAS</td><td>0.0</td></tr>
<tr><td>ccd.013.0.fits</td><td>DARK</td><td>300.0</td></tr>
<tr><td>ccd.014.0.fits</td><td>DARK</td><td>300.0</td></tr>
<tr><td>ccd.015.0.fits</td><td>DARK</td><td>300.0</td></tr>
<tr><td>ccd.017.0.fits</td><td>DARK</td><td>70.0</td></tr>
<tr><td>ccd.018.0.fits</td><td>DARK</td><td>70.0</td></tr>
<tr><td>ccd.019.0.fits</td><td>DARK</td><td>70.0</td></tr>
<tr><td>ccd.023.0.fits</td><td>DARK</td><td>7.0</td></tr>
<tr><td>ccd.024.0.fits</td><td>DARK</td><td>7.0</td></tr>
<tr><td>ccd.025.0.fits</td><td>DARK</td><td>7.0</td></tr>
</table></div></div></div>
</div>
</div>
<div class="section" id="determine-overscan-region-for-the-lfc-chip-0">
<h3><span class="section-number">2.2.2.3. </span>Determine overscan region for the LFC Chip 0<a class="headerlink" href="#determine-overscan-region-for-the-lfc-chip-0" title="Permalink to this headline">¶</a></h3>
<p>Please see the discussion of this camera in
<a class="reference external" href="01.08-Overscan.ipynb#Case-1:-Cryogenically-cooled-Large-Format-Camera-(LFC)-at-Palomar">the Overscan notebook</a> for the appropriate overscan region
to use for this camera. Note, in particular, that it differs from the value
given in the <code class="docutils literal notranslate"><span class="pre">BIASSEC</span></code> keyword in the header of the images.</p>
<p>The astropy affiliated package <a class="reference external" href="https://ccdproc.readthedocs.io">ccdproc</a> provides two
useful functions here:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">subtract_overscan</span></code> for subtracting the overscan from the image, and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trim_image</span></code> for trimming off the overscan.</p></li>
</ul>
<p>First, let’s see the values of <code class="docutils literal notranslate"><span class="pre">BIASSEC</span></code>, which sometimes (but do not always)
indicate that there is is overscan and which part of the chip is the overscan,
as well as the values of <code class="docutils literal notranslate"><span class="pre">CCDSEC</span></code>, which is sometimes but not always present, and indicates which
part of the chip light hit.</p>
<p>Note that neither of these are standard; sometimes, for example, <code class="docutils literal notranslate"><span class="pre">trimsec</span></code> is
used instead of <code class="docutils literal notranslate"><span class="pre">ccdsec</span></code>, and there are likely other variants. Some images may
have neither keyword in the header. This does not necessarily indicate that
ovserscan isn’t present. The best advice is to carefully check the documentation
for the camera you are using.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">files</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;imagetyp&#39;</span><span class="p">,</span> <span class="s1">&#39;biassec&#39;</span><span class="p">,</span> <span class="s1">&#39;ccdsec&#39;</span><span class="p">,</span> <span class="s1">&#39;datasec&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><i>Row index=0</i>
<table id="table139897118487600">
<thead><tr><th>file</th><th>imagetyp</th><th>biassec</th><th>ccdsec</th><th>datasec</th></tr></thead>
<thead><tr><th>str14</th><th>str9</th><th>str18</th><th>str15</th><th>str15</th></tr></thead>
<tr><td>ccd.001.0.fits</td><td>BIAS</td><td>[2049:2080,1:4127]</td><td>[1:2048,1:4128]</td><td>[1:2048,1:4128]</td></tr>
</table></div></div>
</div>
<p>The fits header claims the overscan extends from the 2049<span class="math notranslate nohighlight">\(^{th}\)</span> column to the
end of the image (this is one-based indexing) and that the part of the image
exposed to light extends over all rows and from the first column to the
2048<span class="math notranslate nohighlight">\(^{th}\)</span> column (again, this is one-indexed).</p>
</div>
<div class="section" id="fits-vs-python-indexing">
<h3><span class="section-number">2.2.2.4. </span>FITS vs. Python indexing<a class="headerlink" href="#fits-vs-python-indexing" title="Permalink to this headline">¶</a></h3>
<p>There are two differences between FITS and Python in terms of indexing:</p>
<ul class="simple">
<li><p>Python indexes are zero-based (i.e., numbering starts at zero), while FITS indexes
are one-based (i.e., numbering starts at one).</p></li>
<li><p>The <em>order</em> of the indexes is swapped.</p></li>
</ul>
<p>For example, the <strong>FITS</strong> representation of the part of the chip exposed to
light is <code class="docutils literal notranslate"><span class="pre">[1:2048,1:4128]</span></code>. To access that part of the data from a NumPy array
in <strong>Python</strong>, switch the order so that the indexing looks like this: <code class="docutils literal notranslate"><span class="pre">[0:4128,</span> <span class="pre">0:2048]</span></code> (or, more compactly <code class="docutils literal notranslate"><span class="pre">[:,</span> <span class="pre">:2048]</span></code>). Note that the <em>ending</em> indexes given
here for Python are correct because the second part of a range (after the colon)
is <em>not included</em> in the array slice. For example, <code class="docutils literal notranslate"><span class="pre">0:2048</span></code> starts at 0 (the
first pixel) and goes up to but does not include 2048, so the last pixel included
is <code class="docutils literal notranslate"><span class="pre">2047</span></code> (the 2048<span class="math notranslate nohighlight">\(^{th}\)</span> pixel).</p>
<p>As discussed in <a class="reference external" href="01.08-Overscan.ipynb#Case-1:-Cryogenically-cooled-Large-Format-Camera-(LFC)-at-Palomar">the Overscan notebook</a>, the useful
overscan region for this camera starts at the 2055<span class="math notranslate nohighlight">\(^{th}\)</span> column, not column
2049 as indicated by the <code class="docutils literal notranslate"><span class="pre">BIASSEC</span></code> keyword in the header. This situation is not
unusual; column 2049 is the first of the columns masked from light by the manufacturer,
but there is some leakage into this region from the rest of the CCD.</p>
<p>If you are going to use overscan you need to carefully examine the overscan in a few
representative images to understand which part of the overscan to use.</p>
<p>In what follows, we will use for the overscan the region (Python/NumPy indexing)
<code class="docutils literal notranslate"><span class="pre">[:,</span> <span class="pre">2055:]</span></code>.</p>
</div>
<div class="section" id="subtract-and-then-trim-the-overscan-one-sample-image">
<h3><span class="section-number">2.2.2.5. </span>Subtract and then trim the overscan (one sample image)<a class="headerlink" href="#subtract-and-then-trim-the-overscan-one-sample-image" title="Permalink to this headline">¶</a></h3>
<p>Using <code class="docutils literal notranslate"><span class="pre">subtract_overscan</span></code> is reasonably concise, as shown in the cell
below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raw_biases</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">files_filtered</span><span class="p">(</span><span class="n">include_path</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">imagetyp</span><span class="o">=</span><span class="s1">&#39;BIAS&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">first_bias</span> <span class="o">=</span> <span class="n">CCDData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">raw_biases</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;adu&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set MJD-OBS to 57402.000000 from DATE-OBS&#39;. [astropy.wcs.wcs]
WARNING:astropy:FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set MJD-OBS to 57402.000000 from DATE-OBS&#39;.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bias_overscan_subtracted</span> <span class="o">=</span> <span class="n">ccdp</span><span class="o">.</span><span class="n">subtract_overscan</span><span class="p">(</span><span class="n">first_bias</span><span class="p">,</span> <span class="n">overscan</span><span class="o">=</span><span class="n">first_bias</span><span class="p">[:,</span> <span class="mi">2055</span><span class="p">:],</span> <span class="n">median</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we trim off the full overscan region (not just the part we used for
subtracting overscan).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trimmed_bias</span> <span class="o">=</span> <span class="n">ccdp</span><span class="o">.</span><span class="n">trim_image</span><span class="p">(</span><span class="n">bias_overscan_subtracted</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2048</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="n">show_image</span><span class="p">(</span><span class="n">first_bias</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Raw bias&#39;</span><span class="p">)</span>
<span class="n">show_image</span><span class="p">(</span><span class="n">trimmed_bias</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Bias, overscan subtracted and trimmed&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Bias, overscan subtracted and trimmed&#39;)
</pre></div>
</div>
<img alt="../_images/02-02-Calibrating-bias-images_27_1.png" src="../_images/02-02-Calibrating-bias-images_27_1.png" />
</div>
</div>
</div>
<div class="section" id="discussion">
<h3><span class="section-number">2.2.2.6. </span>Discussion<a class="headerlink" href="#discussion" title="Permalink to this headline">¶</a></h3>
<p>Visually, the images look nearly identical before and after calibration. The
only prominent difference is a shift in the pixel values, as one would expect
from subtracting the same value from each pixel in an image. It simply shifts
the zero point.</p>
<p>There is one other important difference between the images: the input image
uses 32MB of memory while the calibrated, overscan-subtracted image uses roughly
128MB. The input image is stored as unsigned 16-bit integers; the calibrated
image is stored as floating point numbers, which default in Python to 64-bit
floats. The memory size is also the size the files will have when written to
disk (ignoring any compression). You can reduce the memory and disk footprint by
changing the <code class="docutils literal notranslate"><span class="pre">dtype</span></code> of the image: <code class="docutils literal notranslate"><span class="pre">trimmed_bias.data</span> <span class="pre">=</span> <span class="pre">trimmed_bias.data.astype('float32')</span></code>. It is best
to do this just before writing the image out because arithmetic operations on
the image may convert its <code class="docutils literal notranslate"><span class="pre">dtype</span></code> back to <code class="docutils literal notranslate"><span class="pre">float64</span></code>.</p>
</div>
<div class="section" id="processing-the-folder-of-bias-images-for-the-lfc-chip-0">
<h3><span class="section-number">2.2.2.7. </span>Processing the folder of bias images for the LFC Chip 0<a class="headerlink" href="#processing-the-folder-of-bias-images-for-the-lfc-chip-0" title="Permalink to this headline">¶</a></h3>
<p>Processing each of the bias images individually would be tedious, at best.
Instead, we can use the <a class="reference external" href="https://ccdproc.readthedocs.io/en/latest/ccdproc/image_management.html"><code class="docutils literal notranslate"><span class="pre">ImageFileCollection</span></code></a> we created above to
loop over only the bias images, saving each in the folder <code class="docutils literal notranslate"><span class="pre">calibrated_data</span></code>. In
this example, the files are saved uncompressed because the Python library for
compressing gzip files is extremely slow.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">ccd</span><span class="p">,</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">files</span><span class="o">.</span><span class="n">ccds</span><span class="p">(</span><span class="n">imagetyp</span><span class="o">=</span><span class="s1">&#39;BIAS&#39;</span><span class="p">,</span>            <span class="c1"># Just get the bias frames</span>
                                 <span class="n">ccd_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="s1">&#39;adu&#39;</span><span class="p">},</span> <span class="c1"># CCDData requires a unit for the image if </span>
                                                             <span class="c1"># it is not in the header</span>
                                 <span class="n">return_fname</span><span class="o">=</span><span class="kc">True</span>           <span class="c1"># Provide the file name too.</span>
                                <span class="p">):</span>
        <span class="c1"># Subtract the overscan</span>
    <span class="n">ccd</span> <span class="o">=</span> <span class="n">ccdp</span><span class="o">.</span><span class="n">subtract_overscan</span><span class="p">(</span><span class="n">ccd</span><span class="p">,</span> <span class="n">overscan</span><span class="o">=</span><span class="n">ccd</span><span class="p">[:,</span> <span class="mi">2055</span><span class="p">:],</span> <span class="n">median</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># Trim the overscan</span>
    <span class="n">ccd</span> <span class="o">=</span> <span class="n">ccdp</span><span class="o">.</span><span class="n">trim_image</span><span class="p">(</span><span class="n">ccd</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2048</span><span class="p">])</span>
    
    <span class="c1"># Save the result</span>
    <span class="n">ccd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">calibrated_data</span> <span class="o">/</span> <span class="n">file_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set MJD-OBS to 57403.000000 from DATE-OBS&#39;. [astropy.wcs.wcs]
WARNING:astropy:FITSFixedWarning: &#39;datfix&#39; made the change &#39;Set MJD-OBS to 57403.000000 from DATE-OBS&#39;.
</pre></div>
</div>
</div>
</div>
<p>Let’s check that we really did get the images we expect by creating an
<a class="reference external" href="https://ccdproc.readthedocs.io/en/latest/ccdproc/image_management.html"><code class="docutils literal notranslate"><span class="pre">ImageFileCollection</span></code></a> for the reduced folder and displaying the size
of each image. We are expecting the images to be 2048 × 4128, and that there
will be the same number of reduced bias images as input bias images (six).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reduced_images</span> <span class="o">=</span> <span class="n">ccdp</span><span class="o">.</span><span class="n">ImageFileCollection</span><span class="p">(</span><span class="n">calibrated_data</span><span class="p">)</span>
<span class="n">reduced_images</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;imagetyp&#39;</span><span class="p">,</span> <span class="s1">&#39;naxis1&#39;</span><span class="p">,</span> <span class="s1">&#39;naxis2&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>Table length=6</i>
<table id="table139898173214096" class="table-striped table-bordered table-condensed">
<thead><tr><th>file</th><th>imagetyp</th><th>naxis1</th><th>naxis2</th></tr></thead>
<thead><tr><th>str14</th><th>str4</th><th>int64</th><th>int64</th></tr></thead>
<tr><td>ccd.001.0.fits</td><td>BIAS</td><td>2048</td><td>4128</td></tr>
<tr><td>ccd.002.0.fits</td><td>BIAS</td><td>2048</td><td>4128</td></tr>
<tr><td>ccd.003.0.fits</td><td>BIAS</td><td>2048</td><td>4128</td></tr>
<tr><td>ccd.004.0.fits</td><td>BIAS</td><td>2048</td><td>4128</td></tr>
<tr><td>ccd.005.0.fits</td><td>BIAS</td><td>2048</td><td>4128</td></tr>
<tr><td>ccd.006.0.fits</td><td>BIAS</td><td>2048</td><td>4128</td></tr>
</table></div></div></div>
</div>
</div>
</div>
<div class="section" id="example-2-no-overscan-subtraction-but-trim-the-images">
<h2><span class="section-number">2.2.3. </span>Example 2: No overscan subtraction, but trim the images<a class="headerlink" href="#example-2-no-overscan-subtraction-but-trim-the-images" title="Permalink to this headline">¶</a></h2>
<p>If you are not subtracting overscan then the only manipulation you may need to
do is trimming the overscan from the images. If there is no overscan region in
your images then even that is unnecessary.</p>
<div class="section" id="decide-where-to-put-your-calibrated-example-2-images">
<h3><span class="section-number">2.2.3.1. </span>Decide where to put your calibrated Example 2 images<a class="headerlink" href="#decide-where-to-put-your-calibrated-example-2-images" title="Permalink to this headline">¶</a></h3>
<p>Though it is possible to overwrite your raw data with calibrated images, this is not recommended. Here we create a folder called <code class="docutils literal notranslate"><span class="pre">example2-reduced</span></code> that will contain
the calibrated data and create it if it doesn’t exist.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">calibrated_data</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;example2-reduced&#39;</span><span class="p">)</span>
<span class="n">calibrated_data</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">files</span> <span class="o">=</span> <span class="n">ccdp</span><span class="o">.</span><span class="n">ImageFileCollection</span><span class="p">(</span><span class="s1">&#39;example-thermo-electric&#39;</span><span class="p">)</span>
<span class="n">files</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;imagetyp&#39;</span><span class="p">,</span> <span class="s1">&#39;filter&#39;</span><span class="p">,</span> <span class="s1">&#39;exptime&#39;</span><span class="p">,</span> <span class="s1">&#39;naxis1&#39;</span><span class="p">,</span> <span class="s1">&#39;naxis2&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>Table length=32</i>
<table id="table139897115374592" class="table-striped table-bordered table-condensed">
<thead><tr><th>file</th><th>imagetyp</th><th>filter</th><th>exptime</th><th>naxis1</th><th>naxis2</th></tr></thead>
<thead><tr><th>str31</th><th>str5</th><th>object</th><th>float64</th><th>int64</th><th>int64</th></tr></thead>
<tr><td>AutoFlat-PANoRot-r-Bin1-001.fit</td><td>FLAT</td><td>r</td><td>1.0</td><td>4109</td><td>4096</td></tr>
<tr><td>AutoFlat-PANoRot-r-Bin1-002.fit</td><td>FLAT</td><td>r</td><td>1.0</td><td>4109</td><td>4096</td></tr>
<tr><td>AutoFlat-PANoRot-r-Bin1-003.fit</td><td>FLAT</td><td>r</td><td>1.0</td><td>4109</td><td>4096</td></tr>
<tr><td>AutoFlat-PANoRot-r-Bin1-004.fit</td><td>FLAT</td><td>r</td><td>1.0</td><td>4109</td><td>4096</td></tr>
<tr><td>AutoFlat-PANoRot-r-Bin1-005.fit</td><td>FLAT</td><td>r</td><td>1.0</td><td>4109</td><td>4096</td></tr>
<tr><td>AutoFlat-PANoRot-r-Bin1-006.fit</td><td>FLAT</td><td>r</td><td>1.02</td><td>4109</td><td>4096</td></tr>
<tr><td>AutoFlat-PANoRot-r-Bin1-007.fit</td><td>FLAT</td><td>r</td><td>1.06</td><td>4109</td><td>4096</td></tr>
<tr><td>AutoFlat-PANoRot-r-Bin1-008.fit</td><td>FLAT</td><td>r</td><td>1.11</td><td>4109</td><td>4096</td></tr>
<tr><td>AutoFlat-PANoRot-r-Bin1-009.fit</td><td>FLAT</td><td>r</td><td>1.16</td><td>4109</td><td>4096</td></tr>
<tr><td>AutoFlat-PANoRot-r-Bin1-010.fit</td><td>FLAT</td><td>r</td><td>1.21</td><td>4109</td><td>4096</td></tr>
<tr><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr>
<tr><td>Dark-S001-R001-C003-NoFilt.fit</td><td>DARK</td><td>--</td><td>90.0</td><td>4109</td><td>4096</td></tr>
<tr><td>Dark-S001-R001-C004-NoFilt.fit</td><td>DARK</td><td>--</td><td>90.0</td><td>4109</td><td>4096</td></tr>
<tr><td>Dark-S001-R001-C005-NoFilt.fit</td><td>DARK</td><td>--</td><td>90.0</td><td>4109</td><td>4096</td></tr>
<tr><td>Dark-S001-R001-C006-NoFilt.fit</td><td>DARK</td><td>--</td><td>90.0</td><td>4109</td><td>4096</td></tr>
<tr><td>Dark-S001-R001-C007-NoFilt.fit</td><td>DARK</td><td>--</td><td>90.0</td><td>4109</td><td>4096</td></tr>
<tr><td>Dark-S001-R001-C008-NoFilt.fit</td><td>DARK</td><td>--</td><td>90.0</td><td>4109</td><td>4096</td></tr>
<tr><td>Dark-S001-R001-C009-NoFilt.fit</td><td>DARK</td><td>--</td><td>90.0</td><td>4109</td><td>4096</td></tr>
<tr><td>Dark-S001-R001-C020-NoFilt.fit</td><td>DARK</td><td>--</td><td>90.0</td><td>4109</td><td>4096</td></tr>
<tr><td>kelt-16-b-S001-R001-C084-r.fit</td><td>LIGHT</td><td>r</td><td>90.0</td><td>4109</td><td>4096</td></tr>
<tr><td>kelt-16-b-S001-R001-C125-r.fit</td><td>LIGHT</td><td>r</td><td>90.0</td><td>4109</td><td>4096</td></tr>
</table></div></div></div>
</div>
</div>
<div class="section" id="determine-overscan-region-for-this-camera">
<h3><span class="section-number">2.2.3.2. </span>Determine overscan region for this camera<a class="headerlink" href="#determine-overscan-region-for-this-camera" title="Permalink to this headline">¶</a></h3>
<p>Please see the discussion of this camera in <a class="reference external" href="01.08-Overscan.ipynb#Case-2:-Thermo-electrically-cooled-Apogee-Aspen-CG16M">the Overscan notebook</a> for
a discussion of the overscan region of this camera. The overscan for this camera
is not useful but should be trimmed out at this stage.</p>
<p>These headers have some information in the keywords <code class="docutils literal notranslate"><span class="pre">BIASSEC</span></code> and <code class="docutils literal notranslate"><span class="pre">TRIMSEC</span></code>
indicating, in the FITS numbering convention, the overscan region and the
science region of the chip.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">files</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;imagetyp&#39;</span><span class="p">,</span> <span class="s1">&#39;biassec&#39;</span><span class="p">,</span> <span class="s1">&#39;trimsec&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><i>Row index=0</i>
<table id="table139897115377472">
<thead><tr><th>file</th><th>imagetyp</th><th>biassec</th><th>trimsec</th></tr></thead>
<thead><tr><th>str31</th><th>str5</th><th>str11</th><th>str11</th></tr></thead>
<tr><td>AutoFlat-PANoRot-r-Bin1-001.fit</td><td>FLAT</td><td>[4096:4109]</td><td>[1:4096, :]</td></tr>
</table></div></div>
</div>
<p>Based on this, and the decision not to subtract overscan for this camera, we
will only need to trim the overscan region off of the images. See the discussion
at <a class="reference external" href="#FITS-vs-Python-indexing">FITS vs. Python indexing</a>, above, for some details about the
difference between FITS and Python indexing. Essentially, to get Python indexes
from FITS, reverse the order and subtract one.</p>
</div>
<div class="section" id="trim-the-overscan-one-sample-image">
<h3><span class="section-number">2.2.3.3. </span>Trim the overscan (one sample image)<a class="headerlink" href="#trim-the-overscan-one-sample-image" title="Permalink to this headline">¶</a></h3>
<p>The function <code class="docutils literal notranslate"><span class="pre">trim_image</span></code> from <a class="reference external" href="https://ccdproc.readthedocs.io">ccdproc</a> removes a
portion of the image and updates the image metadata as needed.</p>
<p>Below we get the first bias image.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raw_biases</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">files_filtered</span><span class="p">(</span><span class="n">include_path</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">imagetyp</span><span class="o">=</span><span class="s1">&#39;BIAS&#39;</span><span class="p">)</span>

<span class="n">first_bias</span> <span class="o">=</span> <span class="n">CCDData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">raw_biases</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;adu&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:astropy:using the unit adu passed to the FITS reader instead of the unit adu in the FITS file.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO: using the unit adu passed to the FITS reader instead of the unit adu in the FITS file. [astropy.nddata.ccddata]
</pre></div>
</div>
</div>
</div>
<p>There are two ways of specifying the region to trim. One is to slice the image in
Python; the other is to use the <code class="docutils literal notranslate"><span class="pre">fits_section</span></code> argument to <code class="docutils literal notranslate"><span class="pre">trim_image</span></code>.</p>
<p>The cell below uses a FITS-style section.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trimmed_bias_fits</span> <span class="o">=</span> <span class="n">ccdp</span><span class="o">.</span><span class="n">trim_image</span><span class="p">(</span><span class="n">first_bias</span><span class="p">,</span> <span class="n">fits_section</span><span class="o">=</span><span class="s1">&#39;[1:4096, :]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The cell below does the same trimming as the one above, but with Python-style
slicing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trimmed_bias_python</span> <span class="o">=</span> <span class="n">ccdp</span><span class="o">.</span><span class="n">trim_image</span><span class="p">(</span><span class="n">first_bias</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">4096</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="n">trimmed_bias_python</span><span class="p">,</span> <span class="n">trimmed_bias_fits</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="processing-the-folder-of-bias-images-for-example-2">
<h3><span class="section-number">2.2.3.4. </span>Processing the folder of bias images for Example 2<a class="headerlink" href="#processing-the-folder-of-bias-images-for-example-2" title="Permalink to this headline">¶</a></h3>
<p>As in <a class="reference external" href="#Example-1:-With-overscan-subtraction">Example 1</a>, above, we can use the
<a class="reference external" href="https://ccdproc.readthedocs.io/en/latest/ccdproc/image_management.html"><code class="docutils literal notranslate"><span class="pre">ImageFileCollection</span></code></a> we created  to loop over only the bias images,
saving each in the folder <code class="docutils literal notranslate"><span class="pre">calibrated_data</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">ccd</span><span class="p">,</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">files</span><span class="o">.</span><span class="n">ccds</span><span class="p">(</span><span class="n">imagetyp</span><span class="o">=</span><span class="s1">&#39;BIAS&#39;</span><span class="p">,</span>            <span class="c1"># Just get the bias frames</span>
                                 <span class="n">return_fname</span><span class="o">=</span><span class="kc">True</span>           <span class="c1"># Provide the file name too.</span>
                                <span class="p">):</span>    
    <span class="c1"># Trim the overscan</span>
    <span class="n">ccd</span> <span class="o">=</span> <span class="n">ccdp</span><span class="o">.</span><span class="n">trim_image</span><span class="p">(</span><span class="n">ccd</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">4096</span><span class="p">])</span>
    
    <span class="c1"># Save the result</span>
    <span class="n">ccd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">calibrated_data</span> <span class="o">/</span> <span class="n">file_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="example-3-no-overscan-at-all">
<h2><span class="section-number">2.2.4. </span>Example 3: No overscan at all<a class="headerlink" href="#example-3-no-overscan-at-all" title="Permalink to this headline">¶</a></h2>
<p>If there is no overscan then there is, in principle, nothing to be done with the
bias frames. It may be convenient to copy them to the directory with the rest of
your reduced images. The code below does that.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">calibrated_data</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;example3-reduced&#39;</span><span class="p">)</span>
<span class="n">calibrated_data</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">biases</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">files_filtered</span><span class="p">(</span><span class="n">imagetyp</span><span class="o">=</span><span class="s1">&#39;BIAS&#39;</span><span class="p">,</span> <span class="n">include_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">shutil</span>

<span class="k">for</span> <span class="n">bias</span> <span class="ow">in</span> <span class="n">biases</span><span class="p">:</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">bias</span><span class="p">,</span> <span class="n">calibrated_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="02-01-overscan-trimming-and-bias-subtraction-background.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title"><span class="section-number">2.1. </span>About bias and overscan</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="02-04-Combine-bias-images-to-make-master.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title"><span class="section-number">2.3. </span>Combine bias images to make master</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Matthew Craig<br/>
        
            &copy; Copyright 2020-2021.<br/>
          <div class="extra_footer">
            <p xmlns:cc="http://creativecommons.org/ns#" >This work is licensed under
<a href="http://creativecommons.org/licenses/by/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY 4.0
<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1">
<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"></a></p>

          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>